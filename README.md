# gas-flightlog
Google app script version of  drone flight record for japanese law.
`6/16にコード.jsを更新しました。更新してください`
もともとドローンユーザのASAKICHIさんが、作成された物を転用して高機能化しました。
シートを持ってきて、上記のコード.jsをGoogleAppScriptとして登録・公開（デプロイ）するとスマホから利用できます。操作方法は   [【プチプログラミング/ドローン】飛行日誌・入力簡易ツール作ってみた!!【法改正/航空法](https://www.youtube.com/watch?v=WLDBWHJxHiI)あたりをご覧ください。

## 一度やったことある人が思い出すようショートカットメモ
1. AKAKICHIさんのシートを自分のドラブに複製
2. URL中のシートIDをメモ
3. このページの上の方の「コード.js」を自分のGoogleドライブに新規作成したAppScriptにペーストする
4. 作成したAppScriptをデプロイし、デプロイ（実行出来るよう公開）のURLをメモする
5. 機体情報等を埋めておく
6. スマホアプリから、機体ごとに設定を作成し、シートIDやAppScriptのデプロイURL、機体名称を設定する。

## オリジナルとの違い

- メインのシートに直接、開始終了を検知して最終行に書き込みます（触らないシート等が不にになります）
- シートIDを送りアプリ側から書き込みシートを選択して書き込みできます。すなわち、新しいシートにするときにスクリプトを編集不要です(セキュリティ的に問題あるかもですが、プログラム内でいくつかシート固定の内容を使っているので、それが無いシートは書き換えできないので、今のところはまぁいいかと思っています。)
- GETメソッドで最終行が飛行中かどうか取得できます。
- 機体情報も送信可能です
- 弊社製Androidアプリに対応しています。

## 使い方
###シートの準備
1. 以下のリンクから、テンプレートをコピーしてください。
   [【プチプログラミング/ドローン】飛行日誌・入力簡易ツール作ってみた!!【法改正/航空法](https://www.youtube.com/watch?v=WLDBWHJxHiI)

### iPhone
2. iPhoneの方はYoutubeの説明に従いシートを準備します。
3. 次にスクリプトは本リポジトリのコード.jsを開きその中身を動画に従い、作成・デプロイしてください
4. デプロイしたURLもメモしておきます
5. この時点でシートIDとデプロイURLが手元にあることを確認してください。
6. 最後に動画の説明でJSONの辞書型の新規フィールドで動画説明にないdttm,sheetid,droneを追加してください。

| キー名   | 内容                                                         |
| -------- | ------------------------------------------------------------ |
| location | GPS位置情報（場所文字列も可）                                |
| dttm     | 動画説明にある日時（私の好みでキー名を変えてしまった・・・） |
| sheetid  | メモしたシートID                                             |
| drone    | スプレッドシート内のlistシートに記載済みの機体名称           |


### Android
1. [ファットウエア社製の無料Androidアプリ](https://play.google.com/store/apps/details?id=jp.fatware.jpflightrecord)をインストール
2. 機体追加から必要な情報を登録する。
3. TOPページから理発着時にボタンを押す。
